<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DAFTAR MEMBER IKAPUSPAQILLA SALON</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    
    .gradient-header {
      background: linear-gradient(135deg, #DC2626 0%, #B91C1C 30%, #D4AF37 70%, #F59E0B 100%);
    }
    
    .login-gradient {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    
    .gold-shimmer {
      background: linear-gradient(90deg, #D4AF37, #F7DC6F, #D4AF37);
      background-size: 200% auto;
      animation: shimmer 3s linear infinite;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    
    .table-row:hover {
      background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), rgba(220, 38, 38, 0.1));
    }
    
    .tab-active {
      background: linear-gradient(135deg, #DC2626, #D4AF37);
      color: white;
    }
    
    .btn-gold {
      background: linear-gradient(135deg, #D4AF37, #F59E0B);
      transition: all 0.3s ease;
    }
    
    .btn-gold:hover {
      background: linear-gradient(135deg, #F59E0B, #D4AF37);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
    }
    
    .floating-header {
      border-radius: 0 0 24px 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    }
    
    .card-shadow {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .login-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .input-focus:focus {
      border-color: #D4AF37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }
    
    .pagination-btn {
      transition: all 0.2s ease;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #DC2626, #D4AF37);
      color: white;
    }
    
    .pagination-active {
      background: linear-gradient(135deg, #DC2626, #D4AF37);
      color: white;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #DC2626, #D4AF37);
      border-radius: 4px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-50"><!-- Login Page -->
  <div id="loginPage" class="h-full login-gradient flex items-center justify-center p-4">
   <div class="login-card rounded-3xl p-8 w-full max-w-md card-shadow">
    <div class="text-center mb-8">
     <div class="mb-4"><img src="https://lh3.googleusercontent.com/d/1rTcKE5xcEHCqgLIEK4eoep36Z0ZvRR3s" alt="Logo IKAPUSPAQILLA" class="w-24 h-24 mx-auto rounded-full object-cover shadow-lg" loading="lazy" onerror="this.style.background='linear-gradient(135deg, #DC2626, #D4AF37)'; this.alt='Logo';">
     </div>
     <h1 class="text-2xl font-bold text-gray-800 mb-2">Selamat Datang</h1>
     <p class="text-gray-500 text-sm">DAFTAR MEMBER IKAPUSPAQILLA SALON</p>
    </div>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium text-gray-700 mb-2">Username</label> <input type="text" id="username" placeholder="Masukkan username" class="w-full px-4 py-3 rounded-xl border border-gray-300 input-focus focus:outline-none transition-all">
     </div>
     <div><label class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="password" placeholder="Masukkan password" class="w-full px-4 py-3 rounded-xl border border-gray-300 input-focus focus:outline-none transition-all">
     </div>
     <div id="loginError" class="hidden text-red-500 text-sm text-center bg-red-50 p-3 rounded-xl"></div><button onclick="handleLogin()" class="w-full btn-gold text-white font-semibold py-3 rounded-xl mt-4"> Masuk </button>
    </div>
    <p class="text-center text-gray-400 text-xs mt-6">¬© IkeBagus 2026</p>
   </div>
  </div><!-- Main App -->
  <div id="mainApp" class="hidden h-full flex flex-col"><!-- Header -->
   <header class="gradient-header floating-header text-white px-6 py-4 mx-4 mt-4 sticky top-4 z-50">
    <div class="flex items-center justify-center gap-4"><img src="https://lh3.googleusercontent.com/d/1rTcKE5xcEHCqgLIEK4eoep36Z0ZvRR3s" alt="Logo" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md" loading="lazy" onerror="this.style.background='#fff'; this.alt='Logo';">
     <h1 id="headerTitle" class="text-xl md:text-2xl font-bold text-center gold-shimmer">DAFTAR MEMBER IKAPUSPAQILLA SALON</h1>
    </div>
   </header><!-- Tab Navigation -->
   <nav class="flex justify-center gap-2 px-4 mt-6"><button onclick="switchTab('member')" id="tabMember" class="tab-active px-6 py-3 rounded-full font-semibold transition-all duration-300"> üë• Member </button> <button onclick="switchTab('infografis')" id="tabInfografis" class="bg-white px-6 py-3 rounded-full font-semibold text-gray-600 hover:bg-gray-100 transition-all duration-300 card-shadow"> üìä Infografis </button> <button onclick="switchTab('tambah')" id="tabTambah" class="bg-white px-6 py-3 rounded-full font-semibold text-gray-600 hover:bg-gray-100 transition-all duration-300 card-shadow"> ‚ûï Tambah Member </button>
   </nav><!-- Content Area -->
   <main class="flex-1 p-4 overflow-auto"><!-- Member Tab -->
    <div id="contentMember" class="max-w-6xl mx-auto"><!-- Filters -->
     <div class="bg-white rounded-2xl p-4 mb-4 card-shadow">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
       <div><label class="block text-sm font-medium text-gray-600 mb-2">Filter Nama</label> <select id="filterName" onchange="applyFilters()" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none input-focus"> <option value="">Semua Member</option> </select>
       </div>
       <div><label class="block text-sm font-medium text-gray-600 mb-2">Pencarian Cepat</label> <input type="text" id="quickSearch" placeholder="Cari nama, HP, alamat..." onkeyup="applyFilters()" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none input-focus">
       </div>
       <div><label class="block text-sm font-medium text-gray-600 mb-2">Tampilkan</label> <select id="perPage" onchange="changePerPage()" class="w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none input-focus"> <option value="10">10 data</option> <option value="20">20 data</option> <option value="50">50 data</option> <option value="100">100 data</option> <option value="all">Semua</option> </select>
       </div>
       <div class="flex items-end"><button onclick="resetFilters()" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-xl font-medium transition-all"> üîÑ Reset </button>
       </div>
      </div>
     </div><!-- Data Info -->
     <div class="flex justify-between items-center mb-4 px-2">
      <p id="dataInfo" class="text-sm text-gray-600"></p>
      <div id="loadingIndicator" class="hidden"><span class="text-sm text-gray-500">Memuat data...</span>
      </div>
     </div><!-- Table -->
     <div class="bg-white rounded-2xl overflow-hidden card-shadow">
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-600 text-white">
         <tr>
          <th class="px-6 py-4 text-left font-semibold">No</th>
          <th class="px-6 py-4 text-left font-semibold">Nama</th>
          <th class="px-6 py-4 text-left font-semibold">No HP</th>
          <th class="px-6 py-4 text-left font-semibold">Alamat</th>
          <th class="px-6 py-4 text-center font-semibold">Poin</th>
         </tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-100">
         <tr>
          <td colspan="5" class="px-6 py-8 text-center text-gray-500">Memuat data...</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Pagination -->
     <div id="paginationContainer" class="flex justify-center items-center gap-2 mt-6 flex-wrap">
     </div>
    </div><!-- Infografis Tab -->
    <div id="contentInfografis" class="hidden max-w-6xl mx-auto">
     <div class="bg-white rounded-2xl p-6 card-shadow">
      <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">üìä Infografis Poin Member</h2>
      <div class="h-96 md:h-[500px]">
       <canvas id="chartCanvas"></canvas>
      </div>
      <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
       <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white text-center">
        <p class="text-2xl font-bold" id="totalMembers">0</p>
        <p class="text-sm opacity-90">Total Member</p>
       </div>
       <div class="bg-gradient-to-br from-amber-500 to-yellow-500 rounded-xl p-4 text-white text-center">
        <p class="text-2xl font-bold" id="totalPoints">0</p>
        <p class="text-sm opacity-90">Total Poin</p>
       </div>
       <div class="bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl p-4 text-white text-center">
        <p class="text-2xl font-bold" id="avgPoints">0</p>
        <p class="text-sm opacity-90">Rata-rata Poin</p>
       </div>
       <div class="bg-gradient-to-br from-purple-500 to-indigo-500 rounded-xl p-4 text-white text-center">
        <p class="text-2xl font-bold" id="maxPoints">0</p>
        <p class="text-sm opacity-90">Poin Tertinggi</p>
       </div>
      </div><!-- Ranking Table -->
      <div class="mt-8">
       <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2"><span>üèÜ</span> Ranking Member Berdasarkan Poin</h3>
        <div class="flex items-center gap-2"><label class="text-sm font-medium text-gray-600">Tampilkan:</label> <select id="rankingPerPage" onchange="changeRankingPerPage()" class="px-3 py-2 rounded-lg border border-gray-300 focus:outline-none input-focus text-sm"> <option value="10">10 data</option> <option value="20">20 data</option> <option value="50">50 data</option> <option value="all">Semua</option> </select>
        </div>
       </div>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead class="bg-gradient-to-r from-red-600 to-amber-500 text-white">
          <tr>
           <th class="px-4 py-3 text-center font-semibold rounded-tl-xl">Rank</th>
           <th class="px-6 py-3 text-left font-semibold">Nama</th>
           <th class="px-6 py-3 text-left font-semibold">No HP</th>
           <th class="px-6 py-3 text-left font-semibold">Alamat</th>
           <th class="px-4 py-3 text-center font-semibold rounded-tr-xl">Poin</th>
          </tr>
         </thead>
         <tbody id="rankingTableBody" class="divide-y divide-gray-100">
          <tr>
           <td colspan="5" class="px-6 py-8 text-center text-gray-500">Memuat ranking...</td>
          </tr>
         </tbody>
        </table>
       </div><!-- Ranking Pagination -->
       <div id="rankingPaginationContainer" class="flex justify-center items-center gap-2 mt-6 flex-wrap">
       </div>
      </div>
     </div>
    </div><!-- Tambah Member Tab -->
    <div id="contentTambah" class="hidden max-w-4xl mx-auto">
     <div class="bg-white rounded-2xl p-6 card-shadow">
      <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">‚ûï Tambah Member Baru</h2>
      <div class="w-full" style="min-height: 600px;"><iframe src="https://tally.so/embed/q4Vgrg?alignLeft=1&amp;hideTitle=1&amp;transparentBackground=1&amp;dynamicHeight=1" width="100%" height="600" frameborder="0" marginheight="0" marginwidth="0" title="Form Tambah Member" class="rounded-xl"></iframe>
      </div>
      <div class="text-center mt-6"><button onclick="resetForm()" class="inline-block btn-gold text-white font-semibold px-8 py-3 rounded-xl"> ‚úì Ok </button>
      </div>
     </div>
    </div>
   </main><!-- Footer -->
   <footer class="bg-gray-800 text-white py-4 mt-auto">
    <div class="text-center">
     <div class="flex items-center justify-center gap-2 mb-2"><img src="https://lh3.googleusercontent.com/d/1AcUPbZdtoKhbAEDhLgg4102LwKpQeRBn" alt="IkeBagus Logo" class="w-6 h-6 rounded-full object-cover" loading="lazy" onerror="this.style.background='#fff'; this.alt='Logo';">
      <p id="footerText" class="text-sm font-medium">¬© IkeBagus 2026</p>
     </div>
    </div>
   </footer>
  </div>
  <script>
    // Config
    const defaultConfig = {
      site_title: 'DAFTAR MEMBER IKAPUSPAQILLA SALON',
      footer_text: '¬© IkeBagus 2026'
    };
    
    let config = { ...defaultConfig };
    
    // State
    let allData = [];
    let filteredData = [];
    let currentPage = 1;
    let perPage = 10;
    let chart = null;
    let rankingCurrentPage = 1;
    let rankingPerPage = 10;
    
    // Login Handler
    function handleLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('loginError');
      
      if (username === 'admin' && password === 'admin') {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('mainApp').classList.add('flex');
        fetchData();
      } else {
        errorEl.textContent = 'Username atau password salah!';
        errorEl.classList.remove('hidden');
      }
    }
    
    // Enter key login
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !document.getElementById('loginPage').classList.contains('hidden')) {
        handleLogin();
      }
    });
    
    // Fetch Data from Google Sheets
    async function fetchData() {
      const loadingEl = document.getElementById('loadingIndicator');
      loadingEl.classList.remove('hidden');
      
      try {
        const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT9sbTo08vqeSeTTBiFRI4AnYX6n1gCSiTFqX5iZM6f26cZwSNkgI6nCcA8xh9zZ3sAa71oAYjEDRwo/pub?gid=0&single=true&output=csv';
        const response = await fetch(url);
        const text = await response.text();
        
        const rows = parseCSV(text);
        allData = rows.slice(1).map((row, index) => ({
          id: index + 1,
          nama: row[3] || '-',
          noHp: row[4] || '-',
          alamat: row[5] || '-',
          poin: parseInt(row[6]) || 0
        })).filter(item => item.nama !== '-');
        
        filteredData = [...allData];
        populateFilters();
        renderTable();
        updateStats();
        
      } catch (error) {
        console.error('Error fetching data:', error);
        document.getElementById('tableBody').innerHTML = `
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-red-500">Gagal memuat data. Silakan refresh halaman.</td>
          </tr>
        `;
      } finally {
        loadingEl.classList.add('hidden');
      }
    }
    
    // Parse CSV
    function parseCSV(text) {
      const lines = text.split('\n');
      return lines.map(line => {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim());
        return result;
      });
    }
    
    // Populate Filters
    function populateFilters() {
      const filterSelect = document.getElementById('filterName');
      const names = [...new Set(allData.map(item => item.nama))].sort();
      
      filterSelect.innerHTML = '<option value="">Semua Member</option>';
      names.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        filterSelect.appendChild(option);
      });
    }
    
    // Apply Filters
    function applyFilters() {
      const nameFilter = document.getElementById('filterName').value;
      const searchQuery = document.getElementById('quickSearch').value.toLowerCase();
      
      filteredData = allData.filter(item => {
        const matchName = !nameFilter || item.nama === nameFilter;
        const matchSearch = !searchQuery || 
          item.nama.toLowerCase().includes(searchQuery) ||
          item.noHp.toLowerCase().includes(searchQuery) ||
          item.alamat.toLowerCase().includes(searchQuery);
        
        return matchName && matchSearch;
      });
      
      currentPage = 1;
      renderTable();
    }
    
    // Reset Filters
    function resetFilters() {
      document.getElementById('filterName').value = '';
      document.getElementById('quickSearch').value = '';
      document.getElementById('perPage').value = '10';
      perPage = 10;
      filteredData = [...allData];
      currentPage = 1;
      renderTable();
    }
    
    // Change Per Page
    function changePerPage() {
      const value = document.getElementById('perPage').value;
      perPage = value === 'all' ? filteredData.length : parseInt(value);
      currentPage = 1;
      renderTable();
    }
    
    // Render Table
    function renderTable() {
      const tbody = document.getElementById('tableBody');
      const totalItems = filteredData.length;
      const totalPages = Math.ceil(totalItems / perPage) || 1;
      
      const startIndex = (currentPage - 1) * perPage;
      const endIndex = Math.min(startIndex + perPage, totalItems);
      const pageData = filteredData.slice(startIndex, endIndex);
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-gray-500">Tidak ada data ditemukan</td>
          </tr>
        `;
      } else {
        tbody.innerHTML = pageData.map((item, index) => `
          <tr class="table-row transition-colors">
            <td class="px-6 py-4 text-gray-600">${startIndex + index + 1}</td>
            <td class="px-6 py-4 font-medium text-gray-800">${escapeHtml(item.nama)}</td>
            <td class="px-6 py-4 text-gray-600">${escapeHtml(item.noHp)}</td>
            <td class="px-6 py-4 text-gray-600">${escapeHtml(item.alamat)}</td>
            <td class="px-6 py-4 text-center">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${getPoinColor(item.poin)}">
                ${item.poin}
              </span>
            </td>
          </tr>
        `).join('');
      }
      
      document.getElementById('dataInfo').textContent = 
        `Menampilkan ${startIndex + 1}-${endIndex} dari ${totalItems} data`;
      
      renderPagination(totalPages);
    }
    
    // Get Poin Color
    function getPoinColor(poin) {
      if (poin >= 100) return 'bg-gradient-to-r from-amber-400 to-yellow-500 text-white';
      if (poin >= 50) return 'bg-gradient-to-r from-green-400 to-emerald-500 text-white';
      if (poin >= 20) return 'bg-gradient-to-r from-blue-400 to-cyan-500 text-white';
      return 'bg-gray-200 text-gray-700';
    }
    
    // Render Pagination
    function renderPagination(totalPages) {
      const container = document.getElementById('paginationContainer');
      
      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }
      
      let html = '';
      
      html += `<button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} 
        class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        ‚Üê Prev
      </button>`;
      
      const maxVisible = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
      let endPage = Math.min(totalPages, startPage + maxVisible - 1);
      
      if (endPage - startPage < maxVisible - 1) {
        startPage = Math.max(1, endPage - maxVisible + 1);
      }
      
      if (startPage > 1) {
        html += `<button onclick="goToPage(1)" class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600">1</button>`;
        if (startPage > 2) {
          html += `<span class="px-2 text-gray-400">...</span>`;
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<button onclick="goToPage(${i})" 
          class="pagination-btn px-4 py-2 rounded-lg border ${i === currentPage ? 'pagination-active border-transparent' : 'bg-white border-gray-300 text-gray-600'}">
          ${i}
        </button>`;
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          html += `<span class="px-2 text-gray-400">...</span>`;
        }
        html += `<button onclick="goToPage(${totalPages})" class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600">${totalPages}</button>`;
      }
      
      html += `<button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} 
        class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        Next ‚Üí
      </button>`;
      
      container.innerHTML = html;
    }
    
    // Go To Page
    function goToPage(page) {
      const totalPages = Math.ceil(filteredData.length / perPage) || 1;
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderTable();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    
    // Switch Tab
    function switchTab(tab) {
      const tabs = ['Member', 'Infografis', 'Tambah'];
      const contents = ['contentMember', 'contentInfografis', 'contentTambah'];
      const buttons = ['tabMember', 'tabInfografis', 'tabTambah'];
      
      contents.forEach(id => document.getElementById(id).classList.add('hidden'));
      buttons.forEach(id => {
        document.getElementById(id).classList.remove('tab-active');
        document.getElementById(id).classList.add('bg-white', 'text-gray-600');
      });
      
      const index = tabs.map(t => t.toLowerCase()).indexOf(tab);
      document.getElementById(contents[index]).classList.remove('hidden');
      document.getElementById(buttons[index]).classList.add('tab-active');
      document.getElementById(buttons[index]).classList.remove('bg-white', 'text-gray-600');
      
      if (tab === 'infografis' && allData.length > 0) {
        renderChart();
      }
    }
    
    // Update Stats
    function updateStats() {
      const totalMembers = allData.length;
      const totalPoints = allData.reduce((sum, item) => sum + item.poin, 0);
      const avgPoints = totalMembers > 0 ? Math.round(totalPoints / totalMembers) : 0;
      const maxPoints = Math.max(...allData.map(item => item.poin), 0);
      
      document.getElementById('totalMembers').textContent = totalMembers;
      document.getElementById('totalPoints').textContent = totalPoints.toLocaleString();
      document.getElementById('avgPoints').textContent = avgPoints;
      document.getElementById('maxPoints').textContent = maxPoints;
    }
    
    // Render Chart
    function renderChart() {
      const ctx = document.getElementById('chartCanvas').getContext('2d');
      
      if (chart) {
        chart.destroy();
      }
      
      const sortedData = [...allData].sort((a, b) => b.poin - a.poin).slice(0, 20);
      
      const colors = sortedData.map((_, i) => {
        const ratio = i / sortedData.length;
        return `rgba(${220 - ratio * 50}, ${38 + ratio * 137}, ${38 + ratio * 17}, 0.8)`;
      });
      
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sortedData.map(item => item.nama.substring(0, 15)),
          datasets: [{
            label: 'Poin Member',
            data: sortedData.map(item => item.poin),
            backgroundColor: colors,
            borderColor: colors.map(c => c.replace('0.8', '1')),
            borderWidth: 1,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              padding: 12,
              titleFont: { size: 14, weight: 'bold' },
              bodyFont: { size: 13 }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
      
      // Render ranking table
      renderRankingTable();
    }
    
    // Render Ranking Table
    function renderRankingTable() {
      const tbody = document.getElementById('rankingTableBody');
      const sortedData = [...allData].sort((a, b) => b.poin - a.poin);
      
      if (sortedData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-gray-500">Tidak ada data</td>
          </tr>
        `;
        return;
      }
      
      const totalItems = sortedData.length;
      const totalPages = Math.ceil(totalItems / rankingPerPage) || 1;
      
      const startIndex = (rankingCurrentPage - 1) * rankingPerPage;
      const endIndex = Math.min(startIndex + rankingPerPage, totalItems);
      const pageData = sortedData.slice(startIndex, endIndex);
      
      tbody.innerHTML = pageData.map((item, index) => {
        const actualRank = startIndex + index + 1;
        let rankBadge = '';
        
        if (actualRank === 1) {
          rankBadge = '<span class="text-2xl">ü•á</span>';
        } else if (actualRank === 2) {
          rankBadge = '<span class="text-2xl">ü•à</span>';
        } else if (actualRank === 3) {
          rankBadge = '<span class="text-2xl">ü•â</span>';
        } else {
          rankBadge = `<span class="text-gray-600 font-semibold">${actualRank}</span>`;
        }
        
        const rowClass = actualRank <= 3 ? 'bg-amber-50' : '';
        
        return `
          <tr class="table-row transition-colors ${rowClass}">
            <td class="px-4 py-4 text-center">${rankBadge}</td>
            <td class="px-6 py-4 font-medium text-gray-800">${escapeHtml(item.nama)}</td>
            <td class="px-6 py-4 text-gray-600">${escapeHtml(item.noHp)}</td>
            <td class="px-6 py-4 text-gray-600">${escapeHtml(item.alamat)}</td>
            <td class="px-4 py-4 text-center">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${getPoinColor(item.poin)}">
                ${item.poin}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      renderRankingPagination(totalPages);
    }
    
    // Change Ranking Per Page
    function changeRankingPerPage() {
      const value = document.getElementById('rankingPerPage').value;
      rankingPerPage = value === 'all' ? allData.length : parseInt(value);
      rankingCurrentPage = 1;
      renderRankingTable();
    }
    
    // Render Ranking Pagination
    function renderRankingPagination(totalPages) {
      const container = document.getElementById('rankingPaginationContainer');
      
      if (totalPages <= 1) {
        container.innerHTML = '';
        return;
      }
      
      let html = '';
      
      html += `<button onclick="goToRankingPage(${rankingCurrentPage - 1})" ${rankingCurrentPage === 1 ? 'disabled' : ''} 
        class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        ‚Üê Prev
      </button>`;
      
      const maxVisible = 5;
      let startPage = Math.max(1, rankingCurrentPage - Math.floor(maxVisible / 2));
      let endPage = Math.min(totalPages, startPage + maxVisible - 1);
      
      if (endPage - startPage < maxVisible - 1) {
        startPage = Math.max(1, endPage - maxVisible + 1);
      }
      
      if (startPage > 1) {
        html += `<button onclick="goToRankingPage(1)" class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600">1</button>`;
        if (startPage > 2) {
          html += `<span class="px-2 text-gray-400">...</span>`;
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<button onclick="goToRankingPage(${i})" 
          class="pagination-btn px-4 py-2 rounded-lg border ${i === rankingCurrentPage ? 'pagination-active border-transparent' : 'bg-white border-gray-300 text-gray-600'}">
          ${i}
        </button>`;
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          html += `<span class="px-2 text-gray-400">...</span>`;
        }
        html += `<button onclick="goToRankingPage(${totalPages})" class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600">${totalPages}</button>`;
      }
      
      html += `<button onclick="goToRankingPage(${rankingCurrentPage + 1})" ${rankingCurrentPage === totalPages ? 'disabled' : ''} 
        class="pagination-btn px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        Next ‚Üí
      </button>`;
      
      container.innerHTML = html;
    }
    
    // Go To Ranking Page
    function goToRankingPage(page) {
      const sortedData = [...allData].sort((a, b) => b.poin - a.poin);
      const totalPages = Math.ceil(sortedData.length / rankingPerPage) || 1;
      if (page >= 1 && page <= totalPages) {
        rankingCurrentPage = page;
        renderRankingTable();
        document.getElementById('contentInfografis').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Reset Form
    function resetForm() {
      const iframe = document.querySelector('#contentTambah iframe');
      if (iframe) {
        iframe.src = iframe.src;
      }
      
      // Show success message
      const successMsg = document.createElement('div');
      successMsg.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg z-50';
      successMsg.innerHTML = '‚úì Form berhasil direset!';
      document.body.appendChild(successMsg);
      
      setTimeout(() => {
        successMsg.remove();
      }, 2000);
    }
    
    // Element SDK Integration
    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      
      const titleEl = document.getElementById('headerTitle');
      if (titleEl) titleEl.textContent = config.site_title || defaultConfig.site_title;
      
      const footerEl = document.getElementById('footerText');
      if (footerEl) footerEl.textContent = config.footer_text || defaultConfig.footer_text;
    }
    
    function mapToCapabilities(cfg) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(cfg) {
      return new Map([
        ['site_title', cfg.site_title || defaultConfig.site_title],
        ['footer_text', cfg.footer_text || defaultConfig.footer_text]
      ]);
    }
    
    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c978b0793656c06',t:'MTc3MDM0ODM1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>